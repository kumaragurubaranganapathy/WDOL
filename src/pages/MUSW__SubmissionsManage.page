<apex:page controller="MUSW.SubmissionsManageController" tabStyle="MUSW__Submission__c" showHeader="{!showHeader}" sidebar="{!showSidebar}">
<apex:form id="f">

    <apex:sectionHeader title="{!parentLabel}" subtitle="Manage Submissions">
        <apex:pageMessages escape="false"/>
    </apex:sectionHeader>
    
    <apex:pageBlock id="pb" title="Upload Documents">
        <apex:pageblockbuttons location="bottom">
            <apex:commandbutton action="{!cancel}" value="Cancel" />
            <apex:commandbutton action="{!save}" value="Save" rendered="{!subs != null && subs.size > 0}"/>
        </apex:pageblockbuttons>
        
        <p>Note that <strong>documents may not exceed the maximum file size <span class="bg-red">10MB</span></strong>.</p>
        <br/>

        <apex:pageBlockTable value="{!subs}" var="s" rendered="{!subs.size > 0}">
             <apex:column HeaderValue="Actions">
                 <apex:outputLabel value="File" for="file" rendered="{!s.Id == currentSId && currentSId !=null}"/>
                 <apex:inputFile value="{!attachment.body}" filename="{!attachment.name}" id="file" rendered="{!s.Id == currentSId && currentSId !=null}"/>
                 <apex:outputLink value="{!s.MUSW__Link__c}" target="_blank" rendered="{!s.MUSW__Link__c!=null && !(s.Id == currentSId && currentSId !=null)}">Download</apex:outputLink>
                 <!--Encapsulate commandLink within actionRegion to avoid reRender issues with inputFile-->
                 <apex:actionRegion >
                     <apex:commandLink value="Upload" reRender="f" rendered="{!s.MUSW__Submission_DateTime__c=null && s.Id != currentSId}">
                         <apex:param name="subId" value="{!s.Id}" assignTo="{!currentSId}"/>
                     </apex:commandLink>
                </apex:actionRegion>
                <br /><br />
                <apex:commandButton action="{!upload}" value="Upload" rendered="{!currentSId != null && s.Id == currentSId}" />
            </apex:column>
            
            <apex:repeat value="{!$ObjectType.MUSW__Submission__c.FieldSets.MUSW__Manage_Submissions_List}" var="f">               
                <apex:column headerValue="{!f.label}">
                    <apex:inputField value="{!s[f]}" rendered="{!CONTAINS('MUSW__Submission_DateTime__c,' + $CurrentPage.parameters.inputs, f) && $User.UITheme != 'PortalDefault'}"/>
                    <apex:outputField value="{!s[f]}" rendered="{!CONTAINS('MUSW__Submission_DateTime__c,' + $CurrentPage.parameters.inputs, f) && $User.UITheme = 'PortalDefault'}"/>
                    <apex:outputField value="{!s[f]}" rendered="{!!CONTAINS('MUSW__Submission_DateTime__c,' + $CurrentPage.parameters.inputs, f)}"/>
                </apex:column>
            </apex:repeat>
        </apex:pageBlockTable>
    </apex:pageBlock>
</apex:form>
</apex:page>