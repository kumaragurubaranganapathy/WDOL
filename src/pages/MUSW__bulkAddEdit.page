<apex:page controller="MUSW.BulkController" showHeader="{!!hideHeader}" sidebar="{!!hideSidebar}">
    <apex:pageMessages />
    <apex:form >
        <apex:sectionHeader title="{!parentLabel}" subtitle="{!trackno}" rendered="{!parentLabel != null && !hideHeader}">
            <apex:commandLink action="{!cancel}"
                value="{!parentLabel}: {!trackno}" immediate="true" />
        </apex:sectionHeader>
        
        <apex:pageblock title="New/Edit {!objLabel}s">
            <apex:pageblockbuttons >
                <apex:commandbutton action="{!save}" value="Save" />
                <apex:commandbutton action="{!cancel}" value="Cancel" immediate="true" />
            </apex:pageblockbuttons>
            
            <apex:pageBlockSection title="Auto-Fill Values" columns="1" collapsible="false" id="autoFillSection" rendered="{!$User.UITheme != 'PortalDefault' && !hideAutofill}">
                <apex:pageBlockTable value="{!sh}" var="s">                    
                    <apex:repeat value="{!listFieldsetFields}" var="f">
                        <apex:column headerValue="{!f.label}">
                            <apex:inputField value="{!s[f]}" required="false" rendered="{!f!='RecordTypeId'}"/>
                            <apex:inputField value="{!s[f]}" onchange="recordTypeChangedJS();" rendered="{!f='RecordTypeId'}"/>
                        </apex:column>
                    </apex:repeat>
                    <apex:repeat value="{!psh}" var="pName">
                        <apex:repeat value="{!psh[pName]}" var="p">
                            <apex:repeat value="{!fieldNameLabel[pName]}" var="f">
                                <apex:column headerValue="{!fieldNameLabel[pName][f]}">
                                    <apex:inputField value="{!p[f]}" required="false" rendered="{!f!='RecordTypeId'}"/>
                                    <apex:inputField value="{!p[f]}" onchange="recordTypeChangedJS();" rendered="{!f='RecordTypeId'}"/>
                                </apex:column>
                            </apex:repeat>
                        </apex:repeat>
                    </apex:repeat>
                </apex:pageBlockTable>
            </apex:pageBlockSection>
            
            <apex:commandButton action="{!fillDown}" value="Fill Down"
                title="Enter values above and click to fill each column below"
                rerender="objlist" rendered="{!$User.UITheme != 'PortalDefault' && !hideAutofill}"/>
            
            <apex:pageBlockSection title="New/Edit {!objLabel}s ({!recordCount})" columns="1" collapsible="false" id="itemList">
                <apex:outputText >Enter data for each row and click <b>Save</b> to save changes. Blank rows will not be saved.</apex:outputText>
                <apex:pageBlockTable value="{!svos}" var="svo" id="objlist">
                    <apex:column headerValue="Select">
							<apex:facet name="header"> <apex:inputCheckbox id="checkall" onclick="checkAll(this,'autofillSelected')" styleClass="checkAllSt" />
							</apex:facet>
                    	<apex:inputCheckbox value="{!svo.selected}" id="autofillSelected" onchange="checkAllStatus(this)"/>
                    </apex:column>
                    <apex:repeat value="{!listFieldsetFields}" var="ff">
                        <apex:column headerValue="{!ff.label}">
                            <apex:outputPanel title="{!$ObjectType[objName].Fields[ff].inlineHelpText}" >
                            <apex:inputField value="{!svo.obj[ff]}" rendered="{!ff!='RecordTypeId'}"/>
                            <apex:inputField value="{!svo.obj[ff]}" onchange="recordTypeChangedJS();" rendered="{!ff='RecordTypeId'}"/>
                            </apex:outputPanel>
                        </apex:column>
                    </apex:repeat>
                    <apex:repeat value="{!relatedFieldsList}" var="ff" >
                        <apex:column headerValue="{!ff.label}">
                            <apex:inputField value="{!svo.obj[ff]}" rendered="{!ff!='RecordTypeId'}"/>
                            <apex:inputField value="{!svo.obj[ff]}" onchange="recordTypeChangedJS();" rendered="{!ff='RecordTypeId'}"/>
                        </apex:column>
                    </apex:repeat>
                </apex:pageBlockTable>
            </apex:pageBlockSection>
            
            <apex:commandButton action="{!addRow}" value="Add Rows"
                title="Click for more defaulted rows to add" id="addRowButton"
                rerender="objlist" immediate="false" rendered="{!$User.UITheme != 'PortalDefault'}"/>
            <apex:inputText value="{!addRowCount}" id="addRowCount" size="2"
                maxlength="2" rendered="{!$User.UITheme != 'PortalDefault'}" />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
            <apex:commandButton action="{!hideRow}"
                value="Hide Row" title="Click to hide last row (does not delete)"
                id="hideRowButton" rerender="objlist" rendered="{!$User.UITheme != 'PortalDefault'}" immediate="false"/>
        </apex:pageblock>
                
        <apex:actionFunction name="recordTypeChangedJS" reRender="itemList,autoFillSection"/>
        <apex:actionFunction name="pageloadedJS" action="{!initCloneSVOs}" reRender=""/>
    </apex:form>
    
    <!-- Take copies of records -->
    <script>
    pageloadedJS();
   
   	function checkAll(cb,cbid)
    {
        var inputElem = document.getElementsByTagName("input");                     
        for(var i=0; i<inputElem.length; i++)
        {             
             if(inputElem[i].id.indexOf(cbid)!=-1){                                        
                inputElem[i].checked = cb.checked;
            }
        }
    }
    
   	function checkAllStatus(cb)
    {
		var inputElem = document.getElementsByClassName("checkAllSt")[0];
		if(!cb.checked){
			inputElem.checked = false;
		}                
    }
    </script>
</apex:page>