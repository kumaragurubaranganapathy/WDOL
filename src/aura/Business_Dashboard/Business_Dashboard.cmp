<aura:component implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes" 
                access="global" controller="Add_BusinessController">
    <aura:attribute name="businessList" type="List" />
    <aura:attribute name="businessAccount" type="Account" />
    <aura:attribute name="recordTypeId" type="String" />
    <aura:attribute name="selectedAccount" type="String" />
    <aura:attribute name="accEmail" type="String" />
    <aura:attribute name="accPhone" type="string" />
    <aura:attribute name="accUBI" type="String" />
    <aura:attribute name="accountDetail" type="boolean" />
    <aura:attribute name="licenseDetail" type="boolean" />
    <aura:attribute name="courseDetail" type="boolean" default="false"/>
    <aura:attribute name="licenseId" type="String" />
    <aura:attribute name="LicenseData" type="MUSW__License2__c" />
    <aura:attribute name="EndorsementData" type="Endorsement__c" />
    <aura:attribute name="AddressData" type="List" />
    <aura:attribute name="existingAcc" type="boolean" default="false" />
    <aura:attribute name="isDisplayTabs" type="boolean" default="true"/>
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:attribute name="breadcrumbLabel" type="string" />
    <aura:attribute name="screenOne" type="Boolean" default="true"/>
    <aura:attribute name="screenTwo" type="Boolean" default="false"/>
    <aura:attribute name="screenThree" type="Boolean" default="false"/>
    <aura:attribute name="todayDate" type="String" />
    <aura:attribute name="SelectedAccountDetails" type="Account"/>
    <aura:attribute name = "ParcelObj" type ="List"/>
    
    <!-- Pending draft Application -->
    <aura:attribute name="CompletedRequestColumns" type="List" default="['REQUEST #','REQUEST TYPE','REQUEST AGAINST','STATUS', 'COMPLETION DATE']" />
    <aura:attribute name="CompletedRequestData" type="List" default="" />
    
    <!-- Affiliated Locations -->
    <aura:attribute name="affiliatedLoc" type="Boolean" default="true" />
    
    <aura:handler name="businessRefresh" event="c:RefreshEvent" action="{!c.handleComponentEvent}"/>
    <div class="business-outer-wrapper">
        <aura:if isTrue="{!or(v.screenTwo, v.screenThree)}">
            <lightning:breadcrumbs class="slds-p-vertical_x-small">
                <lightning:breadcrumb class="transform-text breadcumb" label="Business Dashboard" href="javascrit:void(0)" onclick="{!c.navigateToScreenOne}"/>
                <lightning:breadcrumb class="{!or(v.screenTwo,v.screenThree)?'transform-text breadcumb':'slds-hide'}" label="{!v.breadcrumbLabel}" href="javascrit:void(0)" onclick="{!c.navigateToScreenTwo}"/>
                <lightning:breadcrumb class="{!v.screenThree?'transform-text breadcumb':'slds-hide'}" label="License 123456789" href="javascrit:void(0)" onclick="{!c.navigateToScreenThree}"/>
            </lightning:breadcrumbs>
        </aura:if>
        <aura:if isTrue="{!v.screenOne}">	
            <div class="business-dashboard-header">
                <h2 class="page-title">Business Dashboard</h2>
                <div class="biz-welcome">                   
                    
                    <c:LnP_AddBusiness recordTypeId="{!v.recordTypeId}"/>
                    
                </div>
            </div>
            <div class="business-dashboard-body">
                <aura:if isTrue="{!v.businessList.length!=0?'true':'false'}">
                    <lightning:layout class="slds-wrap business-wrapper">
                        <aura:iteration items="{!v.businessList}" var="business">
                            <lightning:layoutItem size="12" mediumDeviceSize="3" class="slds-box business-card">
                                <div class="biz-name-wrapper">
                                    <a href="javascript:void(0)" class="business-name" id="{!business.Id}" onclick="{!c.businessDetails}">{!business.Name}</a>
                                </div>
                                <!--<lightning:layout class="slds-wrap business-det">
                                    <lightning:layoutItem size="12" mediumDeviceSize="8" class="">
                                        <div class="field-style">
                                            <div class="label-style">Doing Business As :</div>
                                            <div class="data-style">{!business.Name}</div>
                                        </div>
                                        <div class="field-style">
                                            <div class="label-style">UBI :</div>
                                            <div class="data-style">{!business.UBI_Number__c}</div>
                                        </div>
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="12" mediumDeviceSize="4" class="">
                                        <div class="field-style">
                                            <div class="label-style">Email :</div>
                                            <div class="data-style">{!business.Email__c}</div>
                                        </div>
                                    </lightning:layoutItem>
                                </lightning:layout> -->
                                <div class="biz-address">
                                    {!business.Email__c}
                                </div>
                                <div class="biz-ubi">
                                    <div class="ubi-label">
                                        UBI
                                    </div>
                                    <div class="ubi-num">
                                        {!business.UBI_Number__c}
                                    </div>
                                </div>
                            </lightning:layoutItem>
                        </aura:iteration>
                    </lightning:layout>
                </aura:if>
            </div>
        </aura:if>
        
        <aura:if isTrue="{!v.courseDetail}">
            <div class="license-outer-wrapper" id = "coursedetailsdivid">
                <lightning:layout class="slds-wrap">
                    <lightning:layoutItem size="12" mediumDeviceSize="9">
                        <div class="info-date">
                            {!'Information as of ' + v.todayDate}
                        </div>
                        <div class="license-details-wrapper">
                            <lightning:layout class="details-header slds-wrap">
                                <lightning:layoutItem size="12" mediumDeviceSize="4" class="header-item">
                                    License Number: {!v.LicenseData.Name}
                                </lightning:layoutItem>
                                <lightning:layoutItem size="12" mediumDeviceSize="4" class="header-item">
                                    License Type: {!v.LicenseData.Credential_Type__c}
                                </lightning:layoutItem>                
                                <lightning:layoutItem size="12" mediumDeviceSize="4" class="header-item">
                                    Status: {!v.LicenseData.MUSW__Status__c}
                                </lightning:layoutItem>                
                            </lightning:layout>
                            <div class="details-body">
                                <lightning:layout class="name-details slds-wrap">
                                    <lightning:layoutItem size="12" mediumDeviceSize="4">
                                        <span class="label-style">Business Name:</span> {!v.LicenseData.Ultimate_Parent_Account__r.Name}
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="12" mediumDeviceSize="8">
                                        <span class="label-style">Doing Business As:</span> {!v.LicenseData.Ultimate_Parent_Account__r.Doing_Business_As_1__c}
                                    </lightning:layoutItem>
                                </lightning:layout>
                                <lightning:layout class="contact-details slds-wrap">
                                    <lightning:layoutItem size="12" mediumDeviceSize="4">
                                        <div class="contact-item">
                                            <span class="label-style">Phone:</span> {!v.LicenseData.Ultimate_Parent_Account__r.Business_Phone__c}
                                        </div>
                                        <div class="contact-item">
                                            <span class="label-style">Email:</span> {!v.LicenseData.Ultimate_Parent_Account__r.Email__c}
                                        </div>
                                    </lightning:layoutItem>
                                    
                                    <lightning:layoutItem size="12" class="phy-address" mediumDeviceSize="4">
                                        <aura:iteration items="{!v.AddressData}" var="addressvar">
                                            <aura:if isTrue = "{!addressvar.Address_Type__c == 'Physical Address'}">
                                                <div class="label-style">Physical Address:</div> 
                                                <div class="address">
                                                    {!addressvar.Street__c},<br />
                                                    {!addressvar.City__c},<br />
                                                    {!addressvar.State__c} - {!addressvar.Zip_Postal_Code__c}
                                                </div>
                                            </aura:if>
                                        </aura:iteration>  
                                    </lightning:layoutItem>
                                    
                                    
                                    <lightning:layoutItem size="12" mediumDeviceSize="4">
                                        <aura:iteration items="{!v.AddressData}" var="addressvar">
                                            <aura:if isTrue = "{!addressvar.Address_Type__c == 'Mailing Address'}">
                                                <div class="label-style">Mailing Address:</div> 
                                                <div class="address">
                                                    {!addressvar.Street__c},<br />
                                                    {!addressvar.City__c},<br />
                                                    {!addressvar.State__c} - {!addressvar.Zip_Postal_Code__c}
                                                </div>
                                            </aura:if>
                                        </aura:iteration>
                                    </lightning:layoutItem> 
                                    
                                </lightning:layout>
                                
                                <lightning:layout class="issue-details slds-wrap">
                                    <lightning:layoutItem size="12" mediumDeviceSize="4">
                                        <div class="contact-item">
                                            <span class="label-style">First Issue Date: </span> {!v.LicenseData.Original_Issue_Date__c}
                                        </div>
                                        <div class="contact-item">
                                            <span class="label-style">Current Issue Date: </span> {!v.LicenseData.MUSW__Issue_Date__c}
                                        </div>
                                        <div class="contact-item">
                                            <span class="label-style">Expiration Date: </span> {!v.LicenseData.MUSW__Expiration_Date__c}
                                        </div>                        
                                    </lightning:layoutItem>
                                    <lightning:layoutItem size="12" mediumDeviceSize="8">
                                        <div class="issue-item">
                                            <span class="label-style">Sub-status: </span>{!v.LicenseData.Sub_Status__c}
                                        </div>
                                        <div class="issue-item">
                                            <span class="label-style">Discipline: </span>Yet to be mapped
                                        </div>
                                        <div class="issue-item">
                                            <span class="label-style">Program: </span>{!v.LicenseData.Application_Type__c}
                                        </div>
                                    </lightning:layoutItem>                         
                                </lightning:layout>
                                <div class="endorse-wrapper">
                                    <div class="endorse-header">
                                        Endorsements
                                    </div>
                                    <div class="endorse-details">
                                        <div class="issue-item">
                                            {!v.EndorsementData.Endorsement_Type__c}
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    </lightning:layoutItem>
                    <lightning:layoutItem size="12" mediumDeviceSize="3" class="sidebar-links">
                        <c:Polaris_AMRLink board="{!v.LicenseData.Application_Type__c}" licenseType="{!v.LicenseData.Credential_Type__c}" applicationMethod="{!v.LicenseData.Application_Method__c}" recordId="{!v.LicenseData.Id}"  />
                    </lightning:layoutItem>
                    
                </lightning:layout>
            </div>
        </aura:if>
        
        <aura:if isTrue="{!v.screenTwo}">
            <div class=" slds-m-vertical_xx-large">
                <aura:if isTrue="{!v.accountDetail}"> 
                    <lightning:layout>
                        <lightning:layoutItem size="8" padding="around-small">
                            <div class="Account-name">{!v.SelectedAccountDetails.Name}</div>
                            <lightning:layout>
                                <lightning:layoutItem size="12" padding="around-small">
                                    <div class="field-style"><span class="label-style">Email : </span>{!v.SelectedAccountDetails.Email__c}</div>
                                    <div class="field-style"><span class="label-style">Phone : </span>{!v.SelectedAccountDetails.Business_Phone__c}</div>
                                </lightning:layoutItem>
                                
                                <aura:iteration items="{!v.ParcelObj}" var="parcel" indexVar = "index">
                                    <lightning:layoutItem size="12" padding="around-small">
                                        <aura:if isTrue = "{!parcel.Address_Type__c == 'HOME'}">
                                            <div class="field-style"><span class="label-style">Physical Address:</span></div>
                                            <div class="">{!parcel.MUSW__Street__c},</div>
                                            <div class="">{!parcel.MUSW__City__c},</div>
                                            <div class="">{!parcel.MUSW__State__c} - {!parcel.MUSW__Post_Zip_Code__c}</div>
                                        </aura:if>
                                        <aura:if isTrue = "{!parcel.Address_Type__c == 'MAILING ADDRESS'}">
                                            <div class="field-style"><span class="label-style">Mailing Address:</span></div>
                                            <div class="">{!parcel.MUSW__Street__c},</div>
                                            <div class="">{!parcel.MUSW__City__c},</div>
                                            <div class="">{!parcel.MUSW__State__c} - {!parcel.MUSW__Post_Zip_Code__c}</div>   
                                        </aura:if>
                                    </lightning:layoutItem>
                                </aura:iteration>
                                
                            </lightning:layout>
                        </lightning:layoutItem>
                        <lightning:layoutItem class="nav-links" size="4" padding="around-small">
                            <ul>
                                <a onclick ="{!c.handleLicenseLink}" href="javascript:void(0);">Apply Business License</a><br/>
                                <a onclick="{!c.updateContactInfo}" href="javascript:void(0);">Update Contact Information</a><br/>
                                <a href="javascript:void(0);">Add Contact</a><br/>
                                <a href="javascript:void(0);">Add Course</a><br/>
                                <a href="javascript:void(0);">Edit Profile</a><br/>
                                <a href="javascript:void(0);">Request Name Change</a><br/>
                                <a href="javascript:void(0);">More Actions</a><br/>
                            </ul>
                        </lightning:layoutItem>
                    </lightning:layout>
                </aura:if>
                <aura:if isTrue="{!v.licenseDetail}">
                    <div class="license-outer-wrapper">
                        <lightning:layout class="slds-wrap">
                            <lightning:layoutItem size="12" mediumDeviceSize="9">
                                <div class="info-date">
                                    {!'Information as of ' + v.todayDate}
                                </div>
                                <div class="license-details-wrapper">
                                    <lightning:layout class="details-header slds-wrap">
                                        <lightning:layoutItem size="12" mediumDeviceSize="4" class="header-item">
                                            License Number: {!v.LicenseData.Name}
                                        </lightning:layoutItem>
                                        <lightning:layoutItem size="12" mediumDeviceSize="4" class="header-item">
                                            License Type: {!v.LicenseData.Credential_Type__c}
                                        </lightning:layoutItem>                
                                        <lightning:layoutItem size="12" mediumDeviceSize="4" class="header-item">
                                            Status: {!v.LicenseData.MUSW__Status__c}
                                        </lightning:layoutItem>                
                                    </lightning:layout>
                                    <div class="details-body">
                                        <lightning:layout class="name-details slds-wrap">
                                            <lightning:layoutItem size="12" mediumDeviceSize="4">
                                                <span class="label-style">Business Name:</span> {!v.LicenseData.Ultimate_Parent_Account__r.Name}
                                            </lightning:layoutItem>
                                            <lightning:layoutItem size="12" mediumDeviceSize="8">
                                                <span class="label-style">Doing Business As:</span> {!v.LicenseData.Ultimate_Parent_Account__r.Doing_Business_As_1__c}
                                            </lightning:layoutItem>
                                        </lightning:layout>
                                        <lightning:layout class="contact-details slds-wrap">
                                            <lightning:layoutItem size="12" mediumDeviceSize="4">
                                                <div class="contact-item">
                                                    <span class="label-style">Phone:</span> {!v.LicenseData.Ultimate_Parent_Account__r.Business_Phone__c}
                                                </div>
                                                <div class="contact-item">
                                                    <span class="label-style">Email:</span> {!v.LicenseData.Ultimate_Parent_Account__r.Email__c}
                                                </div>
                                            </lightning:layoutItem>
                                            
                                            <lightning:layoutItem size="12" class="phy-address" mediumDeviceSize="4">
                                                <aura:iteration items="{!v.AddressData}" var="addressvar">
                                                    <aura:if isTrue = "{!addressvar.Address_Type__c == 'Physical Address'}">
                                                        <div class="label-style">Physical Address:</div> 
                                                        <div class="address">
                                                            {!addressvar.Street__c},<br />
                                                            {!addressvar.City__c},<br />
                                                            {!addressvar.State__c} - {!addressvar.Zip_Postal_Code__c}
                                                        </div>
                                                    </aura:if>
                                                </aura:iteration>  
                                            </lightning:layoutItem>
                                            
                                            
                                            <lightning:layoutItem size="12" mediumDeviceSize="4">
                                                <aura:iteration items="{!v.AddressData}" var="addressvar">
                                                    <aura:if isTrue = "{!addressvar.Address_Type__c == 'Mailing Address'}">
                                                        <div class="label-style">Mailing Address:</div> 
                                                        <div class="address">
                                                            {!addressvar.Street__c},<br />
                                                            {!addressvar.City__c},<br />
                                                            {!addressvar.State__c} - {!addressvar.Zip_Postal_Code__c}
                                                        </div>
                                                    </aura:if>
                                                </aura:iteration>
                                            </lightning:layoutItem> 
                                            
                                        </lightning:layout>
                                        
                                        <lightning:layout class="issue-details slds-wrap">
                                            <lightning:layoutItem size="12" mediumDeviceSize="4">
                                                <div class="contact-item">
                                                    <span class="label-style">First Issue Date: </span> {!v.LicenseData.Original_Issue_Date__c}
                                                </div>
                                                <div class="contact-item">
                                                    <span class="label-style">Current Issue Date: </span> {!v.LicenseData.MUSW__Issue_Date__c}
                                                </div>
                                                <div class="contact-item">
                                                    <span class="label-style">Expiration Date: </span> {!v.LicenseData.MUSW__Expiration_Date__c}
                                                </div>                        
                                            </lightning:layoutItem>
                                            <lightning:layoutItem size="12" mediumDeviceSize="8">
                                                <div class="issue-item">
                                                    <span class="label-style">Sub-status: </span>{!v.LicenseData.Sub_Status__c}
                                                </div>
                                                <div class="issue-item">
                                                    <span class="label-style">Discipline: </span>Yet to be mapped
                                                </div>
                                                <div class="issue-item">
                                                    <span class="label-style">Program: </span>{!v.LicenseData.Application_Type__c}
                                                </div>
                                            </lightning:layoutItem>                         
                                        </lightning:layout>
                                        <div class="section-wrapper">
                                            <div class="section-header">
                                                Endorsements
                                            </div>
                                            <div class="section-details">
                                                <div class="issue-item">
                                                    {!v.EndorsementData.Endorsement_Type__c}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="section-wrapper slds-hide">
                                            <div class="section-header">
                                                Affiliated Locations
                                            </div>
                                            <div class="section-details">
                                                <div class="address-item">
                                                    <c:LnP_LicenseAddress affiliatedLoc="{!v.affiliatedLoc}" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                </div>
                            </lightning:layoutItem>
                            <lightning:layoutItem size="12" mediumDeviceSize="3" class="sidebar-links">
                                <c:Polaris_AMRLink board="{!v.LicenseData.Application_Type__c}" licenseType="{!v.LicenseData.Credential_Type__c}" applicationMethod="{!v.LicenseData.Application_Method__c}" recordId="{!v.LicenseData.Id}" accountId="{!v.selectedAccount}" />
                            </lightning:layoutItem>
                            
                        </lightning:layout>
                    </div>
                </aura:if>
            </div>
            
            <aura:if isTrue="{!!v.courseDetail}">
                <lightning:tabset>
                    <aura:if isTrue="{!v.accountDetail}"> 
                        <lightning:tab class="tab-style" onactive="{!c.setBreadCrumb}"  label="Courses" id="Courses" >
                            <c:Course_LicenseScreen  accountId="{!v.selectedAccount}"/>
                        </lightning:tab>
                        <lightning:tab class="tab-style"  onactive="{!c.setBreadCrumb}" label="Licenses" id="Licenses" >
                            <c:Business_LicenseScreen accountId="{!v.selectedAccount}" />
                        </lightning:tab>
                    </aura:if>
                    <aura:if isTrue="{!v.licenseDetail}">
                        <lightning:tab class="tab-style"  onactive="{!c.setBreadCrumb}" label="Branches" id="Branches" >
                            <c:Business_LicenseScreen accountId="{!v.selectedAccount}" licenseId="{!v.licenseId}" BranchLicenses="true"/>
                        </lightning:tab>
                    </aura:if>   
                    <lightning:tab class="tab-style" label="Relationships" onactive="{!c.setBreadCrumb}" id="Relationships" >
                        <c:LnP_Add_Contact accountId="{!v.selectedAccount}" accountName="{!v.SelectedAccountDetails.Name}"/>
                        <br></br>                                                                                                                         
                        <br></br> 
                        <c:LnP_Relationship sObjectName="MUSW__Account_Contact__c" queryId="{!v.selectedAccount}" accountName="{!v.SelectedAccountDetails.Name}" />  
                        <aura:if isTrue="{!v.licenseDetail}">
                            <c:LnP_Add_Association  parentLicense="{!v.licenseId}" />
                            <br></br><br></br>
                            <c:LnP_Relationship sObjectName="Associations__c" queryId="{!v.licenseId}" />
                        </aura:if>  
                    </lightning:tab>
                    <lightning:tab class="tab-style" onactive="{!c.setBreadCrumb}"  label="Draft Applications" id="Draft Applications" >
                        <c:BusinessDetails_DraftApplications accountId="{!v.selectedAccount}"/>
                    </lightning:tab>
                    <lightning:tab class="tab-style" onactive="{!c.setBreadCrumb}" label="Pending Applications" id="Pending Applications" >
                        <c:BusinessDetails_PendingApplications accountId="{!v.selectedAccount}" />
                    </lightning:tab>
                    <lightning:tab class="tab-style" onactive="{!c.setBreadCrumb}" label="Completed Requests" id="Completed Requests" >
                        <div class="Completed-Requests">
                            <aura:if isTrue="{!v.CompletedRequestData.length}">
                                <div>**Below are the Maintenance Requests completed in last twelve months</div>
                                <div class="data-table slds-p-vertical_medium">
                                    <table class="slds-table slds-table_cell-buffer slds-table_bordered slds-max-medium-table_stacked">
                                        <thead>
                                            <tr class="slds-line-height_reset">
                                                <aura:iteration items="{!v.CompletedRequestColumns}" var="headerData">
                                                    <th class="" scope="col">
                                                        <div class="slds-truncate" title="{!headerData}">{!headerData}</div>
                                                    </th> 
                                                </aura:iteration>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            
                                            <aura:iteration items="{!v.CompletedRequestData}" var="tableData" indexVar="ind">
                                                <tr class="slds-hint-parent">
                                                    <td data-label="Service_Request_Type__c">
                                                        <div class="slds-truncate">{!tableData.name}</div>
                                                    </td>        
                                                    <td data-label="Service_Request_Type__c">
                                                        <div class="slds-truncate">{!tableData.Service_Request_Type__c}</div>
                                                    </td>
                                                    <td data-label="License_Type__c">
                                                        <div class="slds-truncate">{!tableData.License_Type__c}</div>
                                                    </td>
                                                    <td data-label="LastModifiedDate">
                                                        <div class="slds-truncate">{!tableData.endTime}</div>
                                                    </td>  
                                                </tr> 
                                            </aura:iteration>
                                        </tbody>
                                    </table>
                                </div>
                                <aura:set attribute="else">
                                    <div class="slds-align_absolute-center">You have no completed requests from past 12 months</div>
                                </aura:set>
                            </aura:if>
                        </div>
                    </lightning:tab>
                    <aura:if isTrue="{!v.licenseDetail}">
                        <lightning:tab class="tab-style" onactive="{!c.setBreadCrumb}" label="Exam" id="Exam" >
                            <c:LnP_ExamReschedule licenseData = "{!v.LicenseData}"/>
                        </lightning:tab>
                    </aura:if>
                </lightning:tabset>
            </aura:if>
        </aura:if>
        <aura:if isTrue="{!v.screenThree}">
            <c:Business_LicenseScreen />
        </aura:if>
    </div>
</aura:component>