<aura:component implements="forceCommunity:availableForAllPageTypes" access="global" controller="Polaris_RenewLicenseController">
    <aura:attribute name="section" type="List"/>
    <aura:attribute name="licID" type="String"/>
    <aura:attribute name="RenewReinstate" type="String"/>
    <aura:attribute name="currentTab" type="Integer" default="1"/>
    <aura:attribute name="totalTabs" type="Integer" default="1"/>
    <aura:attribute name="licenseType" type="String" default="licenseType"/>
    <aura:attribute name="board" type="String" default="board"/>
    <aura:attribute name="applicationType" type="String" default="applicationType"/>
    <aura:attribute name="flowType" type="String" default="License"/>
    <aura:attribute name="licenseWrapper" type="LnP_ApplyForLicenseWrapper[]"/>
    <aura:attribute name="value" type="List" default="option1"/>
    <aura:attribute name="applicationId" type="Id"/>
    <aura:handler name ="LnP_PassValues" event="c:LnP_PassValues" action="{!c.handlePassValuesEvent}"/>
    <aura:handler name="LnP_setCurrTabEvent" event="c:LnP_setCurrTabEvent" action="{!c.getCurrTab}"/>
    <aura:handler name="init" value="{!this}" action="{!c.doInit}"/>
    <aura:attribute name ="recordId" type="String"/>
    <aura:attribute name="objectName" type ="String"/>
    <aura:attribute name="SectionError" type="string[]" default="[]"/>
    <aura:attribute name="currSection" type ="String" default=""/>
    <aura:attribute name="questionsAnswers" type="List"/>
    <aura:attribute name="attachmentResponse" type="List"/>
    <aura:attribute name="certificateValues" type="String" default="false" description="certificate checkbox validation flag" />
    <aura:attribute name="certificateError" type="String" default="" description="Checkbox error message"/>
    <aura:attribute name="attValidation" type="Boolean" default="true"/>
    <aura:attribute name="attestValue" type="String"/>
    <aura:attribute name="AttFlagForsubmit" type="Boolean" default="false"/>
    <aura:attribute name="popupHeader" type="string" default="" description="On submit success popup header"/> 
    <aura:attribute name="popupBody" type="string" default="" description="On submit success popup body"/>
    <aura:attribute name="isOpen" type="boolean" default="false" description="Hide or Show popup boolean"/>
    <aura:attribute name="serverStatus" type="string" default="fail" description="On submit success check the server status before redirection to cart"/>
    <aura:attribute name="storeServerValue" type="string" default="" description="To store value of server response"/>
    <aura:registerEvent name="LnP_getAttJSON" type="c:LnP_getAttJSON"/>
    <aura:attribute name="currentUser" type="User" /> 
    <aura:attribute name="showMessage" type="Boolean" default="false" />
    <aura:attribute name="title" type="String" /> 
    <aura:attribute name="loadingSpinner" type="boolean" default="false"/>
    <force:recordData
                      fields="Name, Email, UserType"
                      recordId="{!$SObjectType.CurrentUser.Id}"
                      targetFields="{!v.currentUser}"
                      mode="VIEW"
                      />
    <aura:if isTrue="{!v.loadingSpinner}">
        <lightning:spinner aura:id="spinner" alternativeText="Page is loading..."/>
    </aura:if>
    <div class="content-wrapper">
        <span class="page-info">You are applying for {!v.RenewReinstate} of <span class="italic">{!v.licenseType}</span> under <span class="italic">{!v.board}</span> <!--by <span class="italic">{!v.applicationType}</span>--></span>
        <c:LnP_Path currentTab="{!v.currentTab}" path="{!v.section}" showPath="true" totalTabs="{!v.totalTabs}" items="{!v.licenseWrapper}"/>
        <aura:iteration items="{!v.licenseWrapper}" var="section" indexVar="varSection">
            <aura:if isTrue="{!and(or(section.sectionName=='Personal Information',section.sectionName=='Business Information'), v.currentTab==section.tabIndex)}">
                <div class="personal-info">
                    <c:LnP_RecordForms aura:id ="recordObjectForm" recordId="{!v.recordId}" objectApiName ="{!v.objectName}" section ="{!section}" applicationId="{!v.applicationId}"/>
                </div>
                <aura:set attribute="else">
                    <div class="{!((varSection+1)==v.currentTab)?'slds-grid slds-wrap personal-info':'slds-hide'}">
                        <aura:if isTrue="{!and((section.sectionName=='Background Information' ), v.currentTab==section.tabIndex)}">
                            <!--c:LnP_BackgroundQuestionSection  section ="{!section}" varSection="{!varSection}" currentTab= "{!v.currentTab}"></c:LnP_BackgroundQuestionSection--> 
                            <aura:iteration items="{!section.labelFieldsMap}" var="question" indexVar="questionItem">
                                <div class="{!(question.questionSection!='null')?'background-section slds-large-size_1-of-1':'slds-hide'}">
                                <div style="padding-top:50px" class="{!(question.questionSection!='null')?'section':'slds-hide'}">{!question.questionSection}</div>
                                <div class="{!(question.questionSection!='null')?'sectiondetail':'slds-hide'}">{!question.questionSectionDetail}</div>
                                <aura:if isTrue ="{!question.questionSection!='null'}">
                                    <c:LnP_RecordEditForms sectionList ="{!section}" sectionName="{!question.questionSection}" applicationId = "{!v.applicationId}"/> 
                                </aura:if>
                                </div>
                            </aura:iteration>
                            <aura:set attribute="else">
                                <aura:if isTrue="{!and((section.sectionName=='Review and Submit'), v.currentTab==section.tabIndex)}">
                                    <!-- ATTEST<br></br> -->
                                    <div id="SubmitAndReview" class='field-item slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1'> 
                                        <div class="reviewHeading">QUESTIONS REVIEW</div><br/>
                                        <!-- <aura:iteration items="{!v.questionsAnswers}" var="responses" indexVar="varRes">
                                <label style="font-weight: 600;">{!varRes + 1}. {!responses.question}</label><br></br>
        <p><aura:if isTrue="{!responses.answer != null}">
                                   <i>{!responses.answer}</i><br></br> 
                                    <aura:set attribute="else">
                                        <h1 style="color:Red;"><i>You Have Not Answered this question.<br></br></i></h1>
                                    </aura:set>  
                                </aura:if></p>
                               </aura:iteration> --> 
                                        <aura:iteration items="{!v.questionsAnswers}" var="responses" indexVar="varRes"> 
                                            <!--<span style="padding-right: 9px;">{!varRes + 1}. </span> -->
                                            <div class = "slds-size--1-of-2 slds-medium-size--1-of-2 slds-small-size--1-of-1">
                                                <div>
                                                    <ui:inputText disabled = "true" value="{!responses.question}"/>
                                                </div>
                                                <!-- <p> -->  
                                                <aura:if isTrue="{!responses.answer != null}"> 
                                                    <!-- CR    <aura:if isTrue="{! or(responses.answer != null,responses.answer != '')}"> -->
                                                    <div class = "revAndSubCompletionFont">
                                                        <ui:outputText value="{!responses.answer}"/>
                                                        <!-- CR <aura:if isTrue="{!and(responses.hasChild, responses.value == No)}" >
                                                 {!varRes + 1}
                                                </aura:if>   -->  
                                                    </div>
                                                    <!-- <h1 style="color:Red;"><i>You Have Not Uploaded/Acknowledged this Attachment Item.<br></br></i></h1> -->
                                                    <aura:set attribute="else">
                                                        <!-- <span class="">Attachment Complete</span>  -->
                                                        <div class = "revAndSubErrorFont">
                                                            <ui:outputText value="You Have Not Answered this question."/>
                                                        </div>
                                                    </aura:set>  
                                                </aura:if>                 
                                                <!-- </p> -->
                                            </div>
                                        </aura:iteration>
                                    </div>
                                    <div id="AttachmentValidation" class='field-item slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1'> 
                                        <div class="reviewHeading">MANDATORY SUBMISSIONS REVIEW</div><br/>
                                        <aura:iteration items="{!v.attachmentResponse}" var="attResponses" indexVar="varRes"> 
                                            <!--<span style="padding-right: 9px;">{!varRes + 1}. </span> -->
                                            <div class = "slds-size--1-of-2 slds-medium-size--1-of-2 slds-small-size--1-of-1">
                                                <div>
                                                    <ui:inputText disabled = "true" value="{!attResponses.attachment}"/>
                                                    <aura:if isTrue="{!(((attResponses.uploadOrAck == true &amp;&amp; attResponses.fileNos == 0) || (attResponses.uploadOrAck == null &amp;&amp; (attResponses.acknowledgeResponse == null || attResponses.acknowledgeResponse == false))) &amp;&amp; attResponses.isMandatorySub == true)}"> 
                                                        <div class = "revAndSubErrorFont">
                                                            <ui:outputText value="**Required Submission/Acknowledgement not Complete."/>
                                                        </div>
                                                        <aura:set attribute="else">
                                                            <div class = "revAndSubCompletionFont">
                                                                <ui:outputText value="Complete"/>
                                                            </div>
                                                        </aura:set>  
                                                    </aura:if>  
                                                </div>                
                                            </div>
                                        </aura:iteration>
                                    </div>
                                    <div id="certificationsValidation" class='field-item slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1'> 
                                        <aura:iteration items="{!section.labelFieldsMap}" var="question" indexVar="questionItem">
                                            <div style="padding-top:50px" class="{!(question.questionSection!='null')?'section':'slds-hide'}">{!question.questionSection}</div>
                                            <div class="{!(question.questionSection!='null')?'sectiondetail':'slds-hide'}">{!question.questionSectionDetail}</div>
                                            <div class="slds-form-element">
                                              <div class="slds-form-element__control">
                                                <div class="slds-checkbox certificate-checkbox">
                                                  <input type="checkbox" name="{!'cert'+questionItem}" id="{!'cert'+questionItem}" />
                                                  <label class="slds-checkbox__label" for="{!'cert'+questionItem}">
                                                    <span class="slds-checkbox_faux"></span>
                                                    <span class="slds-form-element__label">{!question.label}</span>
                                                  </label>
                                                </div>
                                              </div>
                                            </div>
                                        </aura:iteration> 
                                        <div class="error checkbox-error slds-m-top_large">{!v.certificateError}</div>
                                    </div>
                                    <div id="AttestationValidation" class='field-item slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1'>                
                                        <div class="reviewHeading attestation">ATTESTATION</div><br/>
                                        <div class="attestBody">Attest before proceeding.</div>
                                        <div class="slds-form-element  field-item slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-3">
                                            <lightning:input aura:id ="attestationText" type="text" name="" value="{!v.attestValue}" label="Attestation"/>                                            
                                           (<span>{!v.currentUser.Name}</span>)
                                        </div>
                                        <aura:if isTrue="{!v.showMessage}">
                                            <ui:message title="{!v.title}" severity="Error" closable="true">
                                                
                                            </ui:message>
                                        </aura:if>
                                        <div class = "revAndSubErrorFont">
                                            <!--<ui:outputText aura:id="ErrorMessageLabel" value="{!v.SectionError}"/>-->
                                            <aura:iteration items="{!v.SectionError}" var="responses" indexVar="varRes"> 
                                                <div class="error-item">Please check {!responses} for errors</div>
                                            </aura:iteration>
                                        </div>
                                    </div>
                                    <aura:set attribute="else">
                                        <div class="{!((varSection+1)==v.currentTab)?'slds-grid slds-wrap':'slds-hide'}">
                                            <aura:iteration items="{!section.labelFieldsMap}" var="question" indexVar="questionItem">
                                                <div class="{!(question.questionSection!='null')?'section':'slds-hide'}">{!question.questionSection}</div>
                                                <div class="{!(question.questionSection!='null')?'sectiondetail':'slds-hide'}">{!question.questionSectionDetail}</div>
                                                <aura:if isTrue="{!question.fieldType=='Picklist'}">
                                                    <!--div id="{!'q'+questionItem}" class="{!(question.isChild)?'slds-hide field-item ':'field-item slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1'}">
                                        <ui:inputSelect label="{!question.label}" value="{!question.value}" change="{!c.showDependentQuestions}">
                                            <aura:iteration items="{!question.fieldValueOptions}" var="option">
                                                <ui:inputSelectOption text="{!option}" label="{!option}"  />
                                            </aura:iteration>
                                        </ui:inputSelect> 
                                    </div-->
                                                    <div id="{!'q'+questionItem}" class="{!(and(!question.value, and(question.isChild, !question.renderedOnUi))?'slds-hide':'') +' field-item devide-list slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1 '}">
                                                        <lightning:select name="{!questionItem}" label="{!question.label}" value="{!question.value}" onchange="{!c.showDependentQuestions}">
                                                            <aura:iteration items="{!question.fieldValueOptions}" var="option">
                                                                <option value="{!option}">{!option}</option>
                                                            </aura:iteration>
                                                        </lightning:select>
                                                    </div>
                                                </aura:if>
                                                <aura:if isTrue="{!question.fieldType=='Radio'}">
                                                    <div id="{!'q'+questionItem}" class="{!(and(!question.value, and(question.isChild, !question.renderedOnUi))?'slds-hide':'') +' field-item devide-list slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1 '}">
                                                        <lightning:radioGroup name="{!questionItem}"
                                                                              label="{!question.label}"
                                                                              options="{!question.radioValueOptions}"
                                                                              value="{!question.value}"
                                                                              type="radio"
                                                                              onchange="{!c.showDependentQuestions}"/>
                                                    </div>
                                                </aura:if>
                                                <aura:if isTrue="{!question.fieldType=='Yes_No'}">
                                                    <div id="{!'q'+questionItem}" class="{!(and(!question.value, and(question.isChild, !question.renderedOnUi))?'slds-hide':'') +' field-item devide-list slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1 '}">
                                                        <lightning:radioGroup name="{!questionItem}"
                                                                              label="{!question.label}"
                                                                              options="{!question.radioValueOptions}"
                                                                              value="{!question.value}"
                                                                              type="radio"
                                                                              onchange="{!c.showDependentQuestions}"/>
                                                    </div>
                                                </aura:if>
                                                
                                                <aura:if isTrue="{!question.fieldType=='Checkbox'}">
                                                    <div id="{!'q'+questionItem}" class="{!(and(!question.value, and(question.isChild, !question.renderedOnUi))?'slds-hide':'') +' field-item devide-list slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1 '}">
                                                        <lightning:checkboxGroup name="{!questionItem}"
                                                                                 label="{!question.label}"
                                                                                 options="{!question.radioValueOptions}"
                                                                                 value="{!question.multiValues}"
                                                                                 onchange="{!c.showDependentQuestions}"/>
                                                    </div>
                                                </aura:if>
                                                <aura:if isTrue="{!question.fieldType=='Text'}">
                                                    <div id="{!'q'+questionItem}" class="{!(and(!question.value, and(question.isChild, !question.renderedOnUi))?'slds-hide':'') +' slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1'}">
                                                        <lightning:input name="{!question.label}" label="{!question.label}" value="{!question.value}" type="{!question.fieldType}" class="field-item slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-3"/>
                                                    </div>
                                                </aura:if> 
                                                <aura:if isTrue="{!question.fieldType=='Textarea'}">
                                                    <div id="{!'q'+questionItem}" class="{!(and(!question.value, and(question.isChild, !question.renderedOnUi))?'slds-hide':'') +' slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1'}">
                                                        <div class="slds-form-element  field-item slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-3">
                                                            <ui:inputTextArea label="{!question.label}"  value="{!question.value}" rows="5"/>
                                                        </div>
                                                    </div>
                                                </aura:if>
                                                <aura:if isTrue="{!question.fieldType=='Date'}">
                                                    <div id="{!'q'+questionItem}" class="{!(and(!question.value, and(question.isChild, !question.renderedOnUi))?'slds-hide':'') + ' slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1'}">
                                                        <lightning:input type="date" name="{!question.label}" label="{!question.label}" value="{!question.value}" class="field-item slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-3"/>
                                                    </div>
                                                </aura:if>
                                                <aura:if isTrue="{!and(question.fieldType=='Attachment',question.uploadFile)}">
                                                    <div id="{!questionItem}" class="{!((question.isChild)?'slds-hide':'')+'field-item slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1'}">
                                                        <c:LnP_Attachment appID="{!v.applicationId}" labelQuesions="{!question.label}" docList="{!question.multiValues}" />
                                                    </div>
                                                    <aura:if isTrue = "{!(question.multiValues.length == 0 &amp;&amp; question.isMandatorySub == true)}">
                                                        <div class="attValidationStyle slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1">
                                                            **Required Submission.
                                                        </div>
                                                    </aura:if>
                                                </aura:if>
                                                
                                                <aura:if isTrue="{!and(question.fieldType=='Attachment',question.acknowledge)}">
                                                    <div id="{!questionItem}" class="{!((question.isChild)?'slds-hide':'')+'field-item slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1'}">
                                                        <div class="{!(!question.uploadFile? '' : 'slds-hide')}">
                                                            <span class="slds-form-element__label">{!question.label}</span> 
                                                        </div>
                                                        <lightning:input type="checkbox" label="Acknowledge" name="input2" checked="{!question.acknowledgeResponse}"/>
                                                    </div>
                                                    <aura:if isTrue = "{!((question.acknowledgeResponse == null || question.acknowledgeResponse == false) &amp;&amp; question.isMandatorySub == true)}">
                                                        <div class="attValidationStyle slds-small-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-1">
                                                            **Required Acknowledgement.
                                                        </div>
                                                    </aura:if>
                                                </aura:if>
                                            </aura:iteration>
                                        </div>
                                    </aura:set>
                                </aura:if>
                            </aura:set>
                        </aura:if>
                    </div>
                </aura:set>
            </aura:if>
        </aura:iteration>
        <div class="slds-grid slds-m-top_xx-large button-section">
            <lightning:button variant="brand" label="Previous" title="Previous" onclick="{! c.previousTab }" disabled="{!(v.currentTab==1)?'true':'false'}" class="{!(v.currentTab==1)?'slds-hide':'btn btn-lnp'}"/>
            <lightning:button variant="brand" label="Next" title="Next" onclick="{! c.nextTab }" class="{!(v.currentTab==v.totalTabs)?'slds-hide':'slds-show pull-right btn btn-lnp'}"/>
            <lightning:button aura:id="FinalSubmitBtnID" variant="success" label="Submit" title="Submit" onclick="{!c.submit }" class="{!(v.AttFlagForsubmit &amp;&amp; v.currentTab==v.totalTabs)?'slds-show pull-right btn btn-lnp':'slds-hide'}"/>
        </div>
    </div>
    <!-- Pop up start -->
    <aura:if isTrue="{!v.isOpen}">             
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true" aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <!-- pop up header-->
                <header class="slds-modal__header">
                    <lightning:buttonIcon iconName="utility:close"
                                          onclick="{! c.closeModel }"
                                          alternativeText="close"
                                          variant="bare-inverse"
                                          class="slds-modal__close"/>
                    <h2>{!v.popupHeader}</h2>
                </header>
                <!-- pop up body -->
                <div class="slds-modal__content slds-p-around_medium">
                    <p>{!v.popupBody}</p>
                </div>
                <!-- pop up footer -->
                <footer class="slds-modal__footer">
                    <lightning:button variant="neutral" 
                                      label="OK"
                                      title="Cancel"
                                      onclick="{! c.closeModel }"/>
                </footer>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </aura:if>
    <!-- pop up end -->
</aura:component>